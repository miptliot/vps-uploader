!function(a){"use strict";var b=function(c,d){var e=function(b,c){return this.text=a("<span/>"),this.bar=a("<div/>").addClass("progress-bar").attr("role","progressbar").attr("aria-valuemin","0").attr("aria-valuemax","100").append(this.text),this.set(0),b.append(a("<div/>").addClass("progress").append(this.bar)),this};e.prototype.set=function(a){0>a&&(a=0),a>100&&(a=100),this.bar.attr("aria-valuenow",a).css("width",a+"%"),this.text.html(a+"%")},e.prototype.remove=function(){this.bar.remove(),this.text.remove()};var g=function(b,c){b.attr("id","vu-"+c.id),this.id=c.id,this.guid=null,this.errors=[],this.name=a("<span/>").addClass("vu-file-name").html(c.name),this.size=a("<span/>").addClass("vu-file-size").html(h(c.size)),this.btnRemove=a("<span/>").addClass("vu-file-remove").click(function(){l(c.id)}).html("&times;"),this.info=a("<div/>").addClass("vu-file-info").append(this.btnRemove).append(this.name).append(this.size);var d=a("<div/>").addClass("vu-file-progress");return this._progress=new e(d),this.element=b.append(this.info).append(d),this};g.prototype.addError=function(b){0==this.errors.length&&this.element.prepend(a("<div/>").addClass("vu-file-errors").append("ul")),this.errors.push(b),this.element.find(".vu-file-errors ul").append(a("<li/>").html(b))},g.prototype.progress=function(a){this._progress.set(a)},g.prototype.remove=function(){this.info.remove(),this._progress.remove(),this.element.remove()},g.prototype.status=function(a){this.element.removeClass(function(a,b){var c=b.match(/(^|\s)vu-file-status-\S+/g);return null==c?null:c.join(" ")}),this.element.addClass("vu-file-status-"+a)};var h=function(a,b){if(0==a)return"0 Byte";var c=1024,d=b+1||3,e=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],f=Math.floor(Math.log(a)/Math.log(c));return(a/Math.pow(c,f)).toPrecision(d)+" "+e[f]},i=function(){for(var a=0;a<s.files.length;a++)s.removeFile(s.files[a]);for(var a=0;a<n.length;a++)n[a].remove();n=[],r.attr("disabled","disabled"),q.attr("disabled","disabled"),p.children("span").html(d.messages.select)},j=function(a){for(var b=0;b<n.length;b++)if(n[b].id==a)return n[b];return null},k=function(a,b){var c=j(a);null!=c&&c.progress(b)},l=function(a){for(var b=0;b<s.files.length;b++)if(s.files[b].uniqueIdentifier==a){s.removeFile(s.files[b]);break}for(var b=0;b<n.length;b++)n[b].id==a&&(n[b].remove(),n.splice(b,1))},m=function(){p.attr("disabled","disabled"),r.attr("disabled","disabled"),q.attr("disabled","disabled");for(var a=0;a<n.length;a++)n[a].btnRemove.remove();s.upload()};this.options=a.extend(!0,{},b.defaults,d);var n=[],o=a("<input/>").attr("type","file"),p=a("<div/>").addClass("btn btn-default vu-file-select").html(a("<span/>").html(d.messages.select)).append(o),q=a("<div/>").addClass("btn btn-primary").html(d.messages.upload).attr("disabled","disabled").click(function(){m()}),r=a("<div/>").addClass("btn btn-warning").html(d.messages.clear).click(function(){i()}).attr("disabled","disabled");c.append(a("<div/>").addClass("vu-controls").append(p).append(q).append(r));var s=new Flow({target:d.target,uploadMethod:"POST",chunkSize:d.chunksize,simultaneousUploads:20,query:d.query});return s.on("filesAdded",function(b,e){q.attr("disabled","disabled");for(var f=0;f<b.length;f++){var h=a("<div/>").addClass("vu-file-item");n.push(new g(h,{id:b[f].uniqueIdentifier,name:b[f].name,size:b[f].size})),c.append(h)}0==n.length?(r.attr("disabled","disabled"),q.attr("disabled","disabled"),p.children("span").html(d.messages.select)):(r.removeAttr("disabled"),q.removeAttr("disabled"),p.children("span").html(d.messages.add))}),s.on("fileError",function(a,b,c){var a=j(f.uniqueIdentifier);null!=a&&(a.status("error"),a.addError(b))}),s.on("fileProgress",function(a){k(a.uniqueIdentifier,parseInt(100*a.progress()))}),s.on("fileSuccess",function(a,b,c){var d=j(a.uniqueIdentifier);null!=d&&(d.status("ok"),d.guid=b)}),s.on("complete",function(){var a=n.map(function(a){return a.guid});window.location="/uploader/file?list="+a.join(",")}),s.assignBrowse(o),this};b.prototype.defaults={extensions:null,messages:{add:"Add files",clear:"Clear list",remove:"Remove file",select:"Select files",upload:"Upload"}},a.fn.uploader=function(c){return this.each(function(){new b(a(this),c)})}}(jQuery);