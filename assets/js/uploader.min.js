!function(a){"use strict";var b=function(c,d){var e=function(b,c){return this.text=a("<span/>"),this.bar=a("<div/>").addClass("progress-bar").attr("role","progressbar").attr("aria-valuemin","0").attr("aria-valuemax","100").append(this.text),this.set(0),b.append(a("<div/>").addClass("progress").append(this.bar)),this};e.prototype.set=function(a){0>a&&(a=0),a>100&&(a=100),this.bar.attr("aria-valuenow",a).css("width",a+"%"),this.text.html(a+"%")},e.prototype.remove=function(){this.bar.remove(),this.text.remove()};var f=function(b,c){b.attr("id","vu-"+c.id),this.id=c.id,this.name=a("<span/>").addClass("vu-file-name").html(c.name),this.size=a("<span/>").addClass("vu-file-size").html(g(c.size)),this.btnRemove=a("<span/>").addClass("vu-file-remove").click(function(){i(c.id)}).html("&times;"),this.info=a("<div/>").addClass("vu-file-info").append(this.btnRemove).append(this.name).append(this.size);var d=a("<div/>").addClass("vu-file-progress");return this.progress=new e(d),this.element=b.append(this.info).append(d),this};f.prototype.progress=function(a){this.progress.set(a)},f.prototype.remove=function(){this.info.remove(),this.progress.remove(),this.element.remove()};var g=function(a,b){if(0==a)return"0 Byte";var c=1024,d=b+1||3,e=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],f=Math.floor(Math.log(a)/Math.log(c));return(a/Math.pow(c,f)).toPrecision(d)+" "+e[f]},h=function(a,b){for(var c=0;c<l.length;c++)if(l[c].id==a){l[c].progress(b);break}},i=function(a){for(var b=0;b<q.files.length;b++)if(q.files[b].uniqueIdentifier==a){q.removeFile(q.files[b]);break}for(var b=0;b<l.length;b++)l[b].id==a&&(l[b].remove(),l.splice(b,1))},j=function(){for(var a=0;a<q.files.length;a++)q.removeFile(q.files[a]);for(var a=0;a<l.length;a++)l[a].remove();l=[],p.attr("disabled","disabled"),o.attr("disabled","disabled"),n.children("span").html(d.messages.select)},k=function(){n.attr("disabled","disabled"),p.attr("disabled","disabled"),o.attr("disabled","disabled");for(var a=0;a<l.length;a++)l[a].btnRemove.remove();q.upload()};this.options=a.extend(!0,{},b.defaults,d);var l=[],m=a("<input/>").attr("type","file"),n=a("<div/>").addClass("btn btn-default vu-file-select").html(a("<span/>").html(d.messages.select)).append(m),o=a("<div/>").addClass("btn btn-primary").html(d.messages.upload).attr("disabled","disabled").click(function(){k()}),p=a("<div/>").addClass("btn btn-warning").html(d.messages.clear).click(function(){j()}).attr("disabled","disabled");c.append(a("<div/>").addClass("vu-controls").append(n).append(o).append(p));var q=new Flow({target:d.target,uploadMethod:"POST",chunkSize:d.chunksize,simultaneousUploads:20,query:d.query});return q.on("filesAdded",function(b,e){o.attr("disabled","disabled");for(var g=0;g<b.length;g++){var h=a("<div/>").addClass("vu-file-item");l.push(new f(h,{id:b[g].uniqueIdentifier,name:b[g].name,size:b[g].size})),c.append(h)}0==l.length?(p.attr("disabled","disabled"),o.attr("disabled","disabled"),n.children("span").html(d.messages.select)):(p.removeAttr("disabled"),o.removeAttr("disabled"),n.children("span").html(d.messages.add))}),q.on("fileProgess",function(a){console.log(a),h(a.uniqueIdentifier,parseInt(100*a.progress()))}),q.assignBrowse(m),this};b.prototype.defaults={extensions:null,messages:{add:"Add files",clear:"Clear list",remove:"Remove file",select:"Select files",upload:"Upload"}},a.fn.uploader=function(c){return this.each(function(){new b(a(this),c)})}}(jQuery);