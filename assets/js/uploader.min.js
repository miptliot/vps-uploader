!function(a){"use strict";var b=function(c,d){var e=function(b,c){return this.text=a("<span/>"),this.bar=a("<div/>").addClass("progress-bar").attr("role","progressbar").attr("aria-valuemin","0").attr("aria-valuemax","100").append(this.text),this.set(0),b.append(a("<div/>").addClass("progress").append(this.bar)),this};e.prototype.set=function(a){0>a&&(a=0),a>100&&(a=100),this.bar.attr("aria-valuenow",a).css("width",a+"%"),this.text.html(a+"%")},e.prototype.remove=function(){this.bar.remove(),this.text.remove()};var f=function(b,c){b.attr("id","vu-"+c.id),this.id=c.id,this.guid=null,this.errors=[],this.name=a("<span/>").addClass("vu-file-name").html(c.name),this.size=a("<span/>").addClass("vu-file-size").html(g(c.size)),this.btnRemove=a("<span/>").addClass("vu-file-remove").click(function(){k(c.id)}).html("&times;"),this.info=a("<div/>").addClass("vu-file-info").append(this.btnRemove).append(this.name).append(this.size);var d=a("<div/>").addClass("vu-file-progress");return this._progress=new e(d),this.element=b.append(this.info).append(d),this};f.prototype.addError=function(b){0==this.errors.length&&this.element.prepend(a("<div/>").addClass("vu-file-errors").append("ul")),this.errors.push(b),this.element.find(".vu-file-errors ul").append(a("<li/>").html(b))},f.prototype.progress=function(a){this._progress.set(a)},f.prototype.remove=function(){this.info.remove(),this._progress.remove(),this.element.remove()},f.prototype.status=function(a){this.element.removeClass(function(a,b){var c=b.match(/(^|\s)vu-file-status-\S+/g);return null==c?null:c.join(" ")}),this.element.addClass("vu-file-status-"+a)};var g=function(a,b){if(0==a)return"0 Byte";var c=1024,d=b+1||3,e=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],f=Math.floor(Math.log(a)/Math.log(c));return(a/Math.pow(c,f)).toPrecision(d)+" "+e[f]},h=function(){for(var a=0;a<r.files.length;a++)r.removeFile(r.files[a]);for(var a=0;a<m.length;a++)m[a].remove();m=[],q.attr("disabled","disabled"),p.attr("disabled","disabled"),o.children("span").html(d.messages.select)},i=function(a){for(var b=0;b<m.length;b++)if(m[b].id==a)return m[b];return null},j=function(a,b){var c=i(a);null!=c&&c.progress(b)},k=function(a){for(var b=0;b<r.files.length;b++)if(r.files[b].uniqueIdentifier==a){r.removeFile(r.files[b]);break}for(var b=0;b<m.length;b++)m[b].id==a&&(m[b].remove(),m.splice(b,1))},l=function(){o.attr("disabled","disabled"),q.attr("disabled","disabled"),p.attr("disabled","disabled");for(var a=0;a<m.length;a++)m[a].btnRemove.remove();r.upload()};this.options=a.extend(!0,{},b.defaults,d);var m=[],n=a("<input/>").attr("type","file"),o=a("<div/>").addClass("btn btn-default vu-file-select").html(a("<span/>").html(d.messages.select)).append(n),p=a("<div/>").addClass("btn btn-primary").html(d.messages.upload).attr("disabled","disabled").click(function(){l()}),q=a("<div/>").addClass("btn btn-warning").html(d.messages.clear).click(function(){h()}).attr("disabled","disabled");c.append(a("<div/>").addClass("vu-controls").append(o).append(p).append(q));var r=new Flow({target:d.target,uploadMethod:"POST",chunkSize:d.chunksize,simultaneousUploads:20,query:d.query,generateUniqueIdentifier:function(){return a.ajax({type:"GET",url:"/uploader/file/guid",async:!1}).responseText}});return r.on("filesAdded",function(b,e){p.attr("disabled","disabled");for(var g=0;g<b.length;g++){var h=a("<div/>").addClass("vu-file-item");m.push(new f(h,{id:b[g].uniqueIdentifier,name:b[g].name,size:b[g].size})),c.append(h)}0==m.length?(q.attr("disabled","disabled"),p.attr("disabled","disabled"),o.children("span").html(d.messages.select)):(q.removeAttr("disabled"),p.removeAttr("disabled"),o.children("span").html(d.messages.add))}),r.on("fileError",function(a,b,c){var d=i(a.uniqueIdentifier);null!=d&&(d.status("error"),d.addError(b))}),r.on("fileProgress",function(a){j(a.uniqueIdentifier,parseInt(100*a.progress()))}),r.on("fileSuccess",function(a,b,c){var d=i(a.uniqueIdentifier);null!=d&&(d.status("ok"),d.guid=a.uniqueIdentifier)}),r.on("complete",function(){var a=m.map(function(a){return a.guid});window.location="/uploader/file?list="+a.join(",")}),r.assignBrowse(n),this};b.prototype.defaults={extensions:null,messages:{add:"Add files",clear:"Clear list",remove:"Remove file",select:"Select files",upload:"Upload"}},a.fn.uploader=function(c){return this.each(function(){new b(a(this),c)})}}(jQuery);